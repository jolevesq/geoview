function sleep(e){const t=Date.now();let n=null;do{n=Date.now()}while(n-t<e)}function createCodeSnippet(){sleep(500);const e=Array.prototype.filter.call(document.getElementsByTagName("script"),e=>null===e.getAttribute("id")),t=e[e.length-1];for(let e=0,n=!0;n;e++){const l=document.getElementById(`codeSnippet${e||""}`);null!==l?l.innerHTML=`<pre>${t.textContent.replace("//create snippets\n","").replace("createConfigSnippet();\n","").replace("createCodeSnippet();\n","")}</pre>`:n=!1}}function createCodeSnippetUsingIDs(){sleep(500);const e=Array.prototype.filter.call(document.getElementsByTagName("script"),e=>null!==e.getAttribute("id"));for(let t=0;t<e.length;t++){const n=e[t];document.querySelectorAll(`[id-script="${n.id}"]`).forEach(e=>{e.innerHTML=`<pre>${n.textContent}</pre>`})}}function createConfigSnippet(){sleep(500);let e=0;for(e=0;e<document.getElementsByClassName("geoview-map").length;e++){let t="";const n=document.getElementsByClassName("geoview-map")[e].id;t=document.getElementById(n).attributes["data-config"];const l=document.getElementById(`${n}CS`);try{if(void 0!==t&&null!==l){const e=t.value.split(/(?<!\\)'/gm).map((e,t)=>t%2?e.replaceAll(/\/\*/gm,String.fromCharCode(1)).replaceAll(/\*\//gm,String.fromCharCode(2)):e).join("'").replaceAll(/\/\*(?<=\/\*)((?:.|\n|\r)*?)(?=\*\/)\*\//gm,"").replaceAll(String.fromCharCode(1),"/*").replaceAll(String.fromCharCode(2),"*/");l.textContent=JSON.stringify(JSON.parse(e.replace(/(\r\n|\n|\r)/gm,"").replace(/(?<!\\)'/gm,'"').replace(/\\'/gm,"'")),void 0,2)}}catch(e){console.log("Error trapped in createConfigSnippet")}}createCollapsible()}function createCollapsible(){const e=document.getElementsByClassName("collapsible");let t;for(t=0;t<e.length;t++){const n=e[t].nextElementSibling;e[t].classList.contains("active")?n.style.display="block":n.style.display="none",e[t].addEventListener("click",function(){this.classList.toggle("active"),this.classList.contains("active")?n.style.display="block":n.style.display="none"})}}function addLog(e,t){const n=document.getElementById(e);n.innerText+=`${t}\n`,n.scrollTop=n.scrollHeight}function addDefaultShapes(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addCircle([-98.94,57.94],{style:{strokeColor:"purple",strokeWidth:2}}),e.layer.geometry.addMarkerIcon([-105.78,57.52]),e.layer.geometry.addPolyline([[-106.17,63.99],[-104.46,62.55],[-102.26,56.44]],{style:{strokeColor:"blue",strokeWidth:2}}),e.layer.geometry.addPolygon([[[-96.71,64.41],[-93.1,62.86],[-94.36,56.67],[-96.71,64.41]]],{style:{strokeColor:"green",strokeWidth:2}})}function addSpecialShapes(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addPolygon([[[-86.06,62.59],[-78.29,62.59],[-80.43,55.73],[-86.06,62.59]]],{style:{strokeColor:"red",strokeWidth:2}})}function addRectangle(e,t){e.layer.geometry.setActiveGeometryGroup(t),e.layer.geometry.addPolygon([[[-100,60],[-100,70],[-70,70],[-70,60],[-100,60]]],{style:{strokeColor:"Indigo",strokeWidth:2,fillColor:"Indigo",fillOpacity:.25}},"rectangle-outline")}function listenToLegendLayerSetChanges(e,t){t.layer.legendsLayerSet.onLayerSetUpdated((t,n)=>{const{resultSet:l}=n,s='<table class="state"><tr class="state"><th class="state">Name</th><th class="state">Status</th></tr>',o=document.getElementById(e),a=Object.keys(l).reduce((e,t)=>{const n=l[t]?.layerName||"",{layerStatus:s}=l[t];return`${e}<tr class="state"><td class="state">${n}</td><td class="state">${s}</td></tr>`},s);o.innerHTML=a&&a!==s?`${a}</table>`:""})}async function onConfigChange(e,t){let n=document.getElementById(e);null===n&&(n=document.createElement("div"),n.setAttribute("id",e),document.getElementById("mapSection").appendChild(n)),n.setAttribute("data-lang",switchLang.value),cgpv.api.hasMapViewer(e)&&await cgpv.api.deleteMapViewer(e);try{listenToLegendLayerSetChanges("sandboxMap-state",await cgpv.api.createMapFromConfig(e,t.target.value,800))}catch(e){console.error("Failed to create map from config",e)}try{const e=await fetch(t.target.value),n=await e.json();document.getElementById("configGeoview").textContent=JSON.stringify(n,null,4);const l=document.querySelector("textarea"),s=document.querySelector(".line-numbers"),o=l.value.split("\n").length;s.innerHTML=Array(o).fill("<span></span>").join(""),document.getElementById("switchTheme").value=n.theme,document.getElementById("switchProjection").value=n.map.viewSettings.projection;const a=document.getElementById("configLoader");window.history.replaceState(null,null,`?config=${a.value}`)}catch(e){console.error("Unable to fetch data:",e)}}function cleanURL(e){const[t,n]=e.split("://"),l=n.indexOf("/"),s=-1===l?n:n.substring(0,l);let o=-1===l?"":n.substring(l);return o=o.replace(/\/+/g,"/"),o.length>1&&o.endsWith("/")&&(o=o.slice(0,-1)),`${t}://${s}${o}`}function testSuiteCreateTable(e){const t=e.mapViewer.mapId,n=e.getDescriptionAsHtml(),l=document.createElement("div");return l.innerHTML=`\n    <div style="white-space: pre-line;">${n}</div>\n    <div style="text-align:right;">\n      <span id="suitesCheck-${t}"></span>\n    </div>\n    <div style="text-align:right;">\n      Suites: <span id="suitesCompleted-${t}">0</span>/<span id="suitesTotal-${t}">0</span>\n    </div>\n    <div style="text-align:right;">\n      Running: <span id="testsRunning-${t}">0</span> | Done success: <span id="testsDoneSuccess-${t}" style="color:green;">0</span> | Done failed: <span id="testsDoneFailed-${t}" style="color:red;">0</span> | Done: <span id="testsDone-${t}">0</span>/<span id="testsTotal-${t}">0</span>\n    </div>\n    <button class="btnLaunchTests" onclick="launchTests('${t}')">LAUNCH TESTS ${t} !</button>\n    <br/><br/>\n    <table id="tableResults-${t}" class="tableResults">\n      <colgroup>\n        <col>\n        <col style="width: 80px;">\n        <col>\n      </colgroup>\n      <thead>\n        <tr><td>TEST</td><td>RESULT</td><td>DETAILS</td></tr>\n      </thead>\n      <tbody id="tableBody-${t}"></tbody>\n    </table>\n  `,l}function testSuiteUpdateTotals(e){document.getElementById("suitesCompleted-"+e.mapViewer.mapId).textContent=e.getSuitesCompleted();document.getElementById("suitesTotal-"+e.mapViewer.mapId).textContent=e.getSuitesTotal();const t=document.getElementById("suitesCheck-"+e.mapViewer.mapId),n=e.getTestsRunning()>0,l=e.getTestsDoneAllAndSuiteDone(),s=e.getTestsDoneAllSuccessAndSuiteDone();t.textContent=l?s?"✔":"✘":n?"⏳":"",t.style.color=l?s?"green":"red":"black";document.getElementById("testsRunning-"+e.mapViewer.mapId).textContent=e.getTestsRunning();document.getElementById("testsDoneSuccess-"+e.mapViewer.mapId).textContent=e.getTestsDoneSuccess();document.getElementById("testsDoneFailed-"+e.mapViewer.mapId).textContent=e.getTestsDoneFailed();document.getElementById("testsDone-"+e.mapViewer.mapId).textContent=e.getTestsDone();document.getElementById("testsTotal-"+e.mapViewer.mapId).textContent=e.getTestsTotal()}function testSuiteUpdateGrandTotal(e){let t=0,n=0,l=0,s=0,o=0,a=0,i=0;const d=Object.values(e);d.forEach(e=>{t+=e.getSuitesCompleted(),n+=e.getSuitesTotal(),l+=e.getTestsRunning(),s+=e.getTestsDoneSuccess(),o+=e.getTestsDoneFailed(),a+=e.getTestsDone(),i+=e.getTestsTotal()});document.getElementById("allSuitesCompleted").textContent=t;document.getElementById("allSuitesTotal").textContent=n;const c=document.getElementById("allSuitesCheck"),r=l>0,m=d.every(e=>e.getTestsDoneAllAndSuiteDone()),p=d.every(e=>e.getTestsDoneAllSuccessAndSuiteDone());c.textContent=m?p?"✔":"✘":r?"⏳":"",c.style.color=m?p?"green":"red":"black";document.getElementById("allSuitesTestsRunning").textContent=l;document.getElementById("allSuitesTestsDoneSuccess").textContent=s;document.getElementById("allSuitesTestsDoneFailed").textContent=o;document.getElementById("allSuitesTestsDone").textContent=a;document.getElementById("allSuitesTestsTotal").textContent=i}function testSuiteAddOrUpdateTestResultRow(e,t,n,l,s){let o=null;"success"===l.getStatus()?o=!0:"failed"===l.getStatus()&&(o=!1);const a=document.getElementById("tableBody-"+e.mapViewer.mapId);if(!a)return void console.error('Table body element with id "tableBody'+e.mapViewer.mapId+'" not found.');let i=document.getElementById(l.id);i||(i=document.createElement("tr"),i.id=l.id,i.classList.add("expanded"),i.appendChild(document.createElement("td")),i.appendChild(document.createElement("td")),i.appendChild(document.createElement("td")),a.appendChild(i));const d=i.cells?.[0];let c="#515ba5";"true-negative"===l.getType()&&(c="#b778e4ff");let r='<font class="test-title" style="color:'+c+";\" onclick=\"this.closest('tr').classList.toggle('expanded'); this.closest('tr').classList.toggle('collapsed');\">"+l.getTitle()+"</font><br/>";r+='<div class="collapsible-content" style="margin-top: 5px;">',r+='<font style="font-size: x-small;"><i>['+t.getName()+" | "+n.getName()+"]</i></font>",r+=l.getStepsAsHtml(),d.innerHTML=r;const m=i.cells?.[1],p=i.cells?.[2];m&&(m.style.textAlign="center",!0===o?(i.classList.add("collapsed"),i.classList.remove("expanded"),m.style.color="green",m.textContent="✔"):!1===o?(i.classList.add("expanded"),i.classList.remove("collapsed"),m.style.color="red",m.textContent="✘",p.textContent=s,p.style.whiteSpace="pre-line"):(m.style.color="black",m.textContent="⏳")),r+="</div>"}function testSuiteEmptyTestResults(e){const t=document.getElementById("tableBody-"+e.mapViewer.mapId);for(;t.firstChild;)t.removeChild(t.firstChild)}