<!doctype html><html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Canadian Geospatial Platform Viewer</title><link rel="shortcut icon" href="./favicon.ico"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="msapplication-config" content="./img/browserconfig.xml"/><meta name="theme-color" content="#ffffff"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><link href="https://fonts.googleapis.com/css?family=Roboto|Montserrat:200,300,400,900|Merriweather" rel="stylesheet"/><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/><link rel="stylesheet" href="css/style.css"/><script src="cgpv-main.js"></script></head><body><div class="header-table"><table><tbody><tr><td><img class="header-logo" alt="logo" src="./img/Logo.png"/></td><td class="header-title"><h1><strong>ESRI Dynamic Layers</strong></h1></td></tr></tbody></table><table><tbody><tr><td><a href="./index.html">Main</a><br/>&nbsp;&nbsp;&nbsp;&nbsp;<a href="./type-of-layers.html">Type Of Layers</a><br/></td></tr><tr><td><p>This page is used to showcase how the viewer may show ESRI Dynamic layer types</p></td></tr><tr><td><a href="#HLYR1">1. Many ESRI Dynamic Layers with legend settings in the config</a><br/><a href="#HLYR2">2. Date filtering using time zone change and non ISO date format</a><br/><a href="#HLYR3">3. Date filtering using ISO UTC dates</a><br/><a href="#HLYR4">4. Many ESRI Dynamic Layers with legend settings in the config - with footer bar</a><br/></td></tr></tbody></table></div><div class="map-title-holder"><h4 id="HLYR4">4. Many ESRI Dynamic Layers with legend settings in the config - with footer bar</h4><a class="ref-link" href="#top">Top</a></div><button class="collapsible active">Map Status Flags</button><pre id="HLYR4-state" class="panel map-title-holder"></pre><div id="LYR4" class="geoview-map" triggerreadycallback="true" data-lang="en" data-config="{
        'map': {
          'interaction': 'dynamic',
          'viewSettings': {
            'zoom': 4,
            'center': [-100, 60],
            'projection': 3857
          },
          'basemapOptions': {
            'basemapId': 'transport',
            'shaded': true,
            'labeled': true
          },
          'listOfGeoviewLayerConfig': [
            {
              'geoviewLayerId': 'uniqueValueId',
              'geoviewLayerName': { 'en': 'uniqueValue' },
              'metadataAccessPath': { 'en': 'https://maps-cartes.ec.gc.ca/arcgis/rest/services/CESI/MapServer/' },
              'geoviewLayerType': 'esriDynamic',
              'listOfLayerEntryConfig': [
                {
                  'layerId': '4',
                  'layerName': { 'en': 'Test' }
                },
                {
                  'layerId': '1',
                  'layerFilter': 'E_Province = \'Alberta\' or E_Province = \'Manitoba\''
                }
              ]
            },
            {
              'geoviewLayerId': 'esriFeatureLYR4',
              'geoviewLayerName': { 'en': 'Temporal_Test_Bed_en' },
              'metadataAccessPath': {
                'en': 'https://maps-cartes.services.geo.ca/server_serveur/rest/services/NRCan/Temporal_Test_Bed_en/MapServer/'
              },
              'geoviewLayerType': 'esriDynamic',
              'listOfLayerEntryConfig': [
                {
                  'layerId': '0'
                }
              ]
            }
          ]
        },
        'components': ['overview-map', 'north-arrow'],
        'footerBar': {
          'tabs': {
            'core': ['legend', 'layers', 'details', 'data-table']
          }
        },
        'corePackages': [],
        'theme': 'geo.ca',
        'suportedLanguages': ['en']
      }"></div><script src="codedoc.js"></script><script src="layerlib.js"></script><script>// initialize cgpv and api events, a callback is optional, used if calling api's after the rendering is ready
      cgpv.init((mapId) => {
        if (mapId === 'allMaps') {
          // // Wire a handle when all queries done after a map click
          // cgpv.api.maps['LYR1'].layer.featureInfoLayerSet.onQueryEnded((sender, payload) => {
          //   const { coordinate, resultSet, eventType } = payload;
          //   createInfoTable('LYR1', 'ResultSetId1', resultSet, eventType);
          // });
          // cgpv.api.maps['LYR1'].layer.legendsLayerSet.onLayerSetUpdated((sender, payload) => {
          //   const { resultSet } = payload;
          //   displayLegend('LegendsId1', resultSet);
          // });

          // // Wire a handle when all queries done after a map click
          // cgpv.api.maps['LYR2'].layer.featureInfoLayerSet.onQueryEnded((sender, payload) => {
          //   const { coordinate, resultSet, eventType } = payload;
          //   createInfoTable('LYR2', 'ResultSetId2', resultSet, eventType);
          // });
          // cgpv.api.maps['LYR2'].layer.legendsLayerSet.onLayerSetUpdated((sender, payload) => {
          //   const { resultSet } = payload;
          //   displayLegend('LegendsId2', resultSet);
          // });

          // // Wire a handle when all queries done after a map click
          // cgpv.api.maps['LYR3'].layer.featureInfoLayerSet.onQueryEnded((sender, payload) => {
          //   const { coordinate, resultSet, eventType } = payload;
          //   createInfoTable('LYR3', 'ResultSetId3', resultSet, eventType);
          // });
          // cgpv.api.maps['LYR3'].layer.legendsLayerSet.onLayerSetUpdated((sender, payload) => {
          //   const { resultSet } = payload;
          //   displayLegend('LegendsId3', resultSet);
          // });

          // listenToLegendLayerSetChanges('HLYR1-state', 'LYR1');
          // listenToLegendLayerSetChanges('HLYR2-state', 'LYR2');
          // listenToLegendLayerSetChanges('HLYR3-state', 'LYR3');
          // listenToLegendLayerSetChanges('HLYR4-state', 'LYR4');

          // create snippets
          createCodeSnippet();
          createConfigSnippet();
        }
      }, (mapId) => {
        // if (mapId === 'allMaps') {
          // Layers are loaded
          // createTableOfFilter('LYR1');
          // createTableOfFilter('LYR2');
          // createTableOfFilter('LYR3');

        //   const field1 = cgpv.api.maps.LYR2.layer.geoviewLayer('historical-flood/0').getTemporalDimension('historical-flood/0').field;
        //   const LYR2_FILTERS = [`${field1} >= date '01/01/2018 05:00:00' and ${field1} <= date '12/31/2019 19:00:00-05:00'`,
        //                         `${field1} > date '01/01/2018 05:00:00' and ${field1} <= date '01/01/2020 05:00:00Z'`,
        //                         `${field1} >= date '01/01/2018 05:00:00' and ${field1} < date '01/01/2020 00:00:00+05:00'`];
        //   let i = 0;
        //   window.setInterval(() => {
        //     const input = document.getElementById('filter-input-LYR2-historical-flood');
        //     if (input) {
        //       input.value = LYR2_FILTERS[i];
        //       const layerConfig = cgpv.api.maps.LYR2.layer.registeredLayers['historical-flood/0'];
        //       const checkbox = document.getElementById('checkbox-LYR2-historical-flood');
        //       cgpv.api.maps.LYR2.layer.geoviewLayer('historical-flood/0').applyViewFilter('historical-flood/0',
        //         LYR2_FILTERS[i],
        //         checkbox.value !== 'true'
        //       );
        //       if (++i === LYR2_FILTERS.length) i = 0;
        //     }
        //   }, 3000)

        //   const field2 = cgpv.api.maps.LYR3.layer.geoviewLayer('historical-flood/0').getTemporalDimension('historical-flood/0').field;
        //   const LYR3_FILTERS = [`${field2} >= date '2018-01-01T00:00:00' and ${field2} <= date '2020-01-01T00:00:00'`,
        //                       `${field2} > date '2018-01-01T00:00:00' and ${field2} <= date '2020-01-01T00:00:00'`,
        //                       `${field2} >= date '2018-01-01T00:00:00' and ${field2} < date '2020-01-01T00:00:00'`];
        //   let j = 0;
        //   window.setInterval(() => {
        //     const input = document.getElementById('filter-input-LYR3-historical-flood');
        //     if (input) {
        //       input.value = LYR3_FILTERS[j];
        //       const layerConfig = cgpv.api.maps.LYR3.layer.registeredLayers['historical-flood/0'];
        //       const checkbox = document.getElementById('checkbox-LYR3-historical-flood');
        //       cgpv.api.maps.LYR3.layer.geoviewLayer('historical-flood/0').applyViewFilter('historical-flood/0',
        //         LYR3_FILTERS[j],
        //         checkbox.value !== 'true'
        //       );
        //       if (++j === LYR3_FILTERS.length) j = 0;
        //     }
        //   }, 3000)

        //   let k = 0;
        //   window.setInterval(() => {
        //     const input = document.getElementById('filter-input-LYR1-esriFeatureLYR1');
        //     if (input) {
        //       const layerConfig = cgpv.api.maps.LYR1.layer.registeredLayers['esriFeatureLYR1/0'];
        //       const checkbox = document.getElementById('checkbox-LYR1-esriFeatureLYR1');
        //       const temporalData = cgpv.api.maps.LYR1.layer.geoviewLayer('esriFeatureLYR1/0').getTemporalDimension('esriFeatureLYR1/0');
        //       cgpv.api.maps.LYR1.layer.geoviewLayer('esriFeatureLYR1/0').applyViewFilter('esriFeatureLYR1/0',
        //         `Date < date '${temporalData.range.range[k]}'`,
        //         checkbox.value !== 'true'
        //       );
        //       input.value = `Date < date '${temporalData.range.range[k]}'`;
        //       if (++k === temporalData.range.range.length) k = 0;
        //     }
        //   }, 1000)
        // }
      });</script></body></html>